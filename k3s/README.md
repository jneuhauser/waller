# uci

It is assumed that a single host should only run one single instance of `k3s`, either as `server` or as `agent`

| name                  | type      |  notes                                                                                                                               |
| ----                  | ----      |  -----                                                                                                                               |
| `disabled`            | bool      | default `0`                                                                                                                          |
| `role`                | string    | default `agent`, can be `server`                                                                                                     |
| `data_dir`            | dir       | absolute path.  k3s will create it if not present yet.  Note that k3s has a default `/var/lib/rancher/k3s` and it's tmpfs on OpenWrt |
| `bind_address`        | ipaddr    | For `server`, The address api server binds to                                                                                        |
| `https_listen_port`   | port      | For `server`, The port api server binds to                                                                                           |
| `server`              | url       | For `agent`, the k3s server api url.  Usually it's something like `https://xxx:6443`                                                 |
| `token`               | string    | For `agent`, the auth token generated by k3s server.  Usually it's stored by server at `<data_dir>/server/node-token`                |

# build

Likely you will need build your own image as k3s (or k8s) requires quite a few
kernel features that are only available builtin (in contrast to kmod).

```config
CONFIG_PACKAGE_k3s=y
CONFIG_k3s_KERNEL=y
CONFIG_GRUB_BOOTOPTS="vsyscall=emulate"
# CONFIG_TARGET_ROOTFS_SQUASHFS is not set
# CONFIG_TARGET_ROOTFS_TARGZ is not set
# CONFIG_TARGET_IMAGES_GZIP is not set
```

# tips & todo

	hexdump -e '16/1 "%02x" 1/1 "\n"' -n 16 /dev/urandom >/etc/machine-id
	ubus call service list '{"name": "k3s", "verbose": true}'

Dependencies may change along k3s version bump.  E.g. 1.0.0 requires kmod-ipt-ipset while 0.8.1 didn't
